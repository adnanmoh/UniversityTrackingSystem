@{
    @model List<TeachingVM>
    ViewData["Title"] = "Teaching Page";
    @inject IRepositoryManager repository

    var TeacherList = new List<Teacher>();
    var teacherRes = await repository.TeacherRepository.GetAll();

    if (teacherRes.Count > 0)
    {
        TeacherList = teacherRes.ToList();
    }

    var YearList = new List<Year>();
    var yearRes = await repository.YearRepository.GetAll();
    if (yearRes.Count > 0)
    {
        YearList = yearRes.ToList();
    }

    var TermList = new List<Term>();
    var termRes = await repository.TermRepository.GetAll();
    if (termRes.Count > 0)
    {
        TermList = termRes.ToList();
    }

    var GroupList = new List<Group>();
    var groupRes = await repository.GroupRepository.GetAll();

    if (groupRes.Count > 0)
    {
        GroupList = groupRes.ToList();

    }

    var SubjectList = new List<Subject>();
    var SubjectRes = await repository.SubjectRepository.GetAll();
    if (SubjectRes.Count > 0)
    {
        SubjectList = SubjectRes.ToList();
    }

    var MajorList = new List<Major>();
    var resMajor = await repository.MajorRepository.GetAll();
    if (resMajor.Count > 0)
    {
        MajorList = resMajor.ToList();
    }
}


<!--Start Main content container-->
<div class="main_content_container">
    <div class="main_container  main_menu_open">
        <!--Start system bath-->
        <div class="home_pass hidden-xs">
            <ul>
                <li class="bring_right"><span class="glyphicon glyphicon-home "></span></li>
                <li class="bring_right"><a href="">التدريس </a></li>
            </ul>
        </div>
        <!--/End system bath-->
        <div class="page_content">
            @{
                var yearName = YearList.FirstOrDefault(x => x.Status == true).Year1;
            }
            <h1 class="heading_title">التدريس للعام @yearName</h1>


            <!--Start status alert-->
            @if (TempData.ContainsKey("error"))
            {

                <div class="alert alert-danger h4" role="alert">@TempData["error"]</div>
            }

            @if (TempData.ContainsKey("msg"))
            {
                <div class="alert alert-success h5" role="alert">@TempData["msg"]</div>
            }
            <!--/End status alert-->


            <a class="bring_left add-new" asp-action="Create">اضافة جديد  <span style="padding-right: 8px;" class="fa fa-user-plus"></span></a>
            <br />
            @if (Model != null)
            {
                @foreach (var major in Model.GroupBy(i => i.MajorId))
                {
                    int gcount = 1;
                    var majorName = MajorList.FirstOrDefault(g => g.MajorId == major.Key)?.Name ?? "غير معروف";

                    <div class="wrap">
                        <div style="margin: 40px 25px;background-color: #001c39;" class="card-header  bg-primary text-white text-center">
                            <h3 style="padding: 10px; ">التخصص : @majorName</h3>
                        </div>

                        @foreach (var group in major.GroupBy(i => i.GroupId))
                        {
                            int count = 1;
                            var groupName = GroupList.FirstOrDefault(g => g.GroupId == group.Key)?.Name ?? "غير معروف";

                            <h2 class="heading_title_table">المجموعة @gcount : @groupName</h2>
                            <table class="table table-bordered level-table">
                                <tr>
                                    <th>#</th>
                                    <td style="width: 250px;">المدرس</td>
                                    <td>المادة</td>
                                    <td>الترم الدراسي</td>
                                    <td>التحكم</td>
                                </tr>

                                @foreach (var item in group)
                                {
                                    var TeacherName = TeacherList.FirstOrDefault(g => g.TeacherId == item.TeacherId)?.Name ?? "غير معروف";
                                    var TermName = TermList.FirstOrDefault(g => g.TermId == item.TermId)?.Name ?? "غير معروف";
                                    var SubjectName = SubjectList.FirstOrDefault(g => g.SubjectId == item.SubjectId)?.Name ?? "غير معروف";

                                    <tr>
                                        <td>@count</td>
                                        <td>@TeacherName</td>
                                        <td>@SubjectName</td>
                                        <td>@TermName</td>
                                        <td>
                                            <a asp-action="Delete" asp-all-route-data='@new Dictionary<string, string>{
                                                                                            {"TeacherID",@item.TeacherId.ToString()},
                                                                                            {"GroupID",@item.GroupId.ToString()},
                                                                                            {"SubjectID",@item.SubjectId.ToString()},
                                                                                            {"MajorID",@item.MajorId.ToString()},
                                                                                            {"YearID",@item.YearId.ToString()},
                                                                                            {"TermID",@item.TermId.ToString()},

                                                                                        }' class="btn alert-danger">حذف <i class="fa fa-trash-o"></i></a>
                                        </td>
                                    </tr>

                                    count++;
                                }

                            </table>
                            gcount++;
                        }
                    </div>
                }
            }






        </div>
    </div>
</div>

<!--/End Main content container-->